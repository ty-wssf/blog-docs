(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{464:function(a,t,s){"use strict";s.r(t);var r=s(30),e=Object(r.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"引入服务网关gateway"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引入服务网关gateway"}},[a._v("#")]),a._v(" 引入服务网关Gateway")]),a._v(" "),s("p",[a._v("在前面的章节中，我们已经完成了服务间的调用、统一配置等等，在这一章节里，我们会引入微服务体系的一个重要组件——网关。")]),a._v(" "),s("h1",{attrs:{id:"网关概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网关概述"}},[a._v("#")]),a._v(" 网关概述")]),a._v(" "),s("h2",{attrs:{id:"为什么要引入网关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要引入网关"}},[a._v("#")]),a._v(" 为什么要引入网关")]),a._v(" "),s("p",[a._v("大家都知道，我们服务端的各个服务调用是从服务注册中心拉取服务列表，再由负载均衡策略去调用对应的服务提供方。")]),a._v(" "),s("p",[a._v("那么，在什么都不做的情况下，看看我们的客户端，包括PC、移动端等等是怎么访问我们的服务端的呢？")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/d7fd15ec56624a4a8c111bb0a1b245f2~tplv-k3u1fbpfcp-watermark.png",alt:"无网关客户端访问服务"}})]),a._v(" "),s("p",[a._v("这么办有什么问题呢？")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("客户端需要维护后端服务的地址，如果我们集群部署，一个服务有数十上百个节点呢？")])]),a._v(" "),s("li",[s("p",[a._v("日志、鉴权等等逻辑，我们每个服务都得搞一套。")])]),a._v(" "),s("li",[s("p",[a._v("服务端的服务都得能被客户端访问，所以需要外网ip，但是ip资源实在太宝贵了。")]),a._v(" "),s("p",[a._v("……")])])]),a._v(" "),s("p",[a._v("这时候就需要在客户端和服务端之间加一个统一的入口，而在微服务的体系中，承担这个角色的就是网关。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/01ca210f19f54c26a8210221a40ad2f5~tplv-k3u1fbpfcp-watermark.png",alt:"引入网关"}})]),a._v(" "),s("p",[a._v("我们加入一个网关，来作为请求的统一接入。我们只需要将网关的机器ip配置到DNS，或者接入层负载，那么客户端的服务最终通过我们的网关，再转发给对应的服务端服务。")]),a._v(" "),s("h2",{attrs:{id:"常见微服务网关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见微服务网关"}},[a._v("#")]),a._v(" 常见微服务网关")]),a._v(" "),s("p",[a._v("目前市面上根据技术栈实现的不同大概有如下一些网关:")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/6747ac7169294a2c98ec24524053215c~tplv-k3u1fbpfcp-watermark.png",alt:"常见网关"}})]),a._v(" "),s("p",[a._v("简单介绍一下这些网关：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("Nginx：")]),a._v(" Nginx由内核和模块组成，内核的设计非常微小和简洁，完成的工作也非常简单，仅仅通过查找配置文件与客户端请求进行 URL 匹配，用于启动不同的模块去完成相应的工作。")]),a._v(" "),s("li",[s("strong",[a._v("Kong:")]),a._v(" Kong是一款基于OpenResty（Nginx + Lua模块）编写的高可用、易扩展的，由Mashape公司开源的API  Gateway项目。Kong是基于NGINX和Apache Cassandra或PostgreSQL构建的，能提供易于使用的RESTful  API来操作和配置API管理系统，所以它可以水平扩展多个Kong服务器，通过前置的负载均衡配置把请求均匀地分发到各个Server，来应对大批量的网络请求。")]),a._v(" "),s("li",[a._v("**Netfilx Zuul：**Zuul 是 Netflix 开源的微服务网关组件，它可以和 Eureka、Ribbon、Hystrix 等组件配合使用。社区活跃，融合于 SpringCloud 完整生态，是构建微服务体系前置网关服务的最佳选型之一。")]),a._v(" "),s("li",[a._v("**Spring Cloud GetWay：**Spring Cloud Gateway 是Spring Cloud的一个全新的API网关项目，目的是为了替换掉Zuul1。Gateway可以与Spring Cloud Discovery  Client（如Eureka）、Ribbon、Hystrix等组件配合使用，实现路由转发、负载均衡、熔断等功能，并且Gateway还内置了限流过滤器，实现了限流的功能。")])]),a._v(" "),s("h1",{attrs:{id:"spring-cloud-getway实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-getway实践"}},[a._v("#")]),a._v(" Spring Cloud GetWay实践")]),a._v(" "),s("p",[a._v("在上面我们已经简单介绍了各种常见的微服务网关，接下来引入我们今天的主角——SpringCloud Gateway。")]),a._v(" "),s("h2",{attrs:{id:"创建网关服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建网关服务"}},[a._v("#")]),a._v(" 创建网关服务")]),a._v(" "),s("ul",[s("li",[a._v("创建网关子module "),s("code",[a._v("esop-gateway")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/7ef01476106541a884c29a4f08417e42~tplv-k3u1fbpfcp-watermark.png",alt:"eshop-gateway"}})]),a._v(" "),s("ul",[s("li",[a._v("引入相关依赖，注意啊，因为网关服务作为一个服务，同样需要配置中心和注册中心，所以，我们也引入了相关依赖")])]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Spring")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Cloud")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Alibaba")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("starter"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("alibaba"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("discovery"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.2")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("RELEASE"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("version"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("alibaba"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("client"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" spring cloud alibaba nacos config 依赖 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("alibaba"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("starter"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("alibaba"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("gateway网关"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("starter"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("gateway"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n复制代码\n")])])]),s("ul",[s("li",[a._v("bootstap.yml：在配置文件里除了应用名称，我们还配置了Nacos的相关配置，不太清楚的同学可以查看上一节。")])]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  application"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" gateway"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("service # 应用名称\n  profiles"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    active"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" dev      # 当前环境对应的 profile\n  cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n      config"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n        enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("     # 如果不想使用 "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Nacos")]),a._v(" 进行配置管理，设置为 "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v(" 即可\n        server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("   # "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Nacos")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Server")]),a._v(" 地址\n        group"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" DEFAULT_GROUP     # 组，默认为 DEFAULT_GROUP\n        file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("extension"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" yaml    # 配置内容的数据格式，默认为 properties\n        namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" dev_space    # 指定命名空间，默认为"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v("\n复制代码\n")])])]),s("h2",{attrs:{id:"路由配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由配置"}},[a._v("#")]),a._v(" 路由配置")]),a._v(" "),s("p",[a._v("我们在nacos中来完成gateway的相关路由的配置。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/ca583a4fa72940ffb2b45eb4189d3903~tplv-k3u1fbpfcp-watermark.png",alt:"gateway服务配置"}})]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9000")]),a._v("\nspring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n      discovery"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n        server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n    gateway"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n      discovery"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n        locator"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n          enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n      routes"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("service\n        uri"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" lb"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("service\n        predicates"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n          "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n        filters:\n          - StripPrefix=1  \n复制代码\n")])])])]),s("p",[a._v("我们在里面进行了路由转发的配置，也就是"),s("code",[a._v("routes")]),a._v(",我们来看一看这些配置项都是什么意思：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("id：")]),a._v(" 路由的"),s("code",[a._v("唯一")]),a._v("标识，用以和其它Route区分")]),a._v(" "),s("li",[s("strong",[a._v("uri：")]),a._v(" 请求要转发到的地址，"),s("strong",[a._v("lb")]),a._v(" 指的是从nacos中按照名称获取微服务，并遵循负载均衡策略")]),a._v(" "),s("li",[s("strong",[a._v("predicates：")]),a._v(" 路由需要满足的条件，也是个数组（这里是"),s("code",[a._v("或")]),a._v("的关系）")]),a._v(" "),s("li",[s("strong",[a._v("filters：")]),a._v(" 过滤器，请求在传递过程中可以通过过滤器对其进行一定的修改")])]),a._v(" "),s("p",[a._v("在这个配置项里，我们定义了"),s("code",[a._v("user")]),a._v(" 开头的请求，分发到"),s("code",[a._v("user-service")]),a._v("这个服务。")]),a._v(" "),s("p",[a._v("接下来我们看看效果吧！")]),a._v(" "),s("h2",{attrs:{id:"路由转发效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由转发效果"}},[a._v("#")]),a._v(" 路由转发效果")]),a._v(" "),s("p",[a._v("回忆一下，在用户服务里有一个get请求的根据 id 获取用户的接口，访问一下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/284b983f1af545cbadad5e217271eb14~tplv-k3u1fbpfcp-watermark.awebp",alt:"获取用户信息接口"}})]),a._v(" "),s("p",[a._v("OK，我们现在不直接访问用户服务的接口，而是改成访问网关服务，我们来看看效果：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df3a608ccf49465a9fd56e8b3f0d1828~tplv-k3u1fbpfcp-watermark.awebp",alt:"网关访问获取用户信息接口"}})]),a._v(" "),s("p",[a._v("我们访问的地址是："),s("a",{attrs:{href:"https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A9000%2Fuser%2Fshop-user%2Fuser%2Fget-by-id%3Fid%3D1",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:9000/user/shop-user/user/get-by-id?id=1"),s("OutboundLink")],1),a._v(" ，简单解析一下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/6396957e5d784b238ec4de4e19fab725~tplv-k3u1fbpfcp-watermark.png",alt:"网关请求路径解析"}})]),a._v(" "),s("p",[a._v("作者：三分恶\n链接：https://juejin.cn/post/6981278079909888037\n来源：掘金\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。")])])}),[],!1,null,null,null);t.default=e.exports}}]);