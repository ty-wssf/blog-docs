(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{540:function(e,t,n){"use strict";n.r(t);var a=n(30),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"æ·±å…¥ç†è§£abstractqueuedsynchronizer-aqs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ·±å…¥ç†è§£abstractqueuedsynchronizer-aqs"}},[e._v("#")]),e._v(" æ·±å…¥ç†è§£AbstractQueuedSynchronizer(AQS)")]),e._v(" "),n("h2",{attrs:{id:"_1-aqsç®€ä»‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-aqsç®€ä»‹"}},[e._v("#")]),e._v(" 1. AQSç®€ä»‹")]),e._v(" "),n("p",[e._v("åœ¨"),n("a",{attrs:{href:"https://juejin.im/post/6844903601534418958",target:"_blank",rel:"noopener noreferrer"}},[e._v("ä¸Šä¸€ç¯‡æ–‡ç« "),n("OutboundLink")],1),e._v("ä¸­æˆ‘ä»¬å¯¹lockå’ŒAbstractQueuedSynchronizer(AQS)æœ‰äº†åˆæ­¥çš„è®¤è¯†ã€‚åœ¨åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼ŒAQSæ˜¯æ ¸å¿ƒéƒ¨åˆ†ï¼ŒåŒæ­¥ç»„ä»¶çš„å®ç°è€…é€šè¿‡ä½¿ç”¨AQSæä¾›çš„æ¨¡æ¿æ–¹æ³•å®ç°åŒæ­¥ç»„ä»¶è¯­ä¹‰ï¼ŒAQSåˆ™å®ç°äº†å¯¹"),n("strong",[e._v("åŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼Œä»¥åŠå¯¹é˜»å¡çº¿ç¨‹è¿›è¡Œæ’é˜Ÿï¼Œç­‰å¾…é€šçŸ¥")]),e._v("ç­‰ç­‰ä¸€äº›åº•å±‚çš„å®ç°å¤„ç†ã€‚AQSçš„æ ¸å¿ƒä¹ŸåŒ…æ‹¬äº†è¿™äº›æ–¹é¢:"),n("strong",[e._v("åŒæ­¥é˜Ÿåˆ—ï¼Œç‹¬å å¼é”çš„è·å–å’Œé‡Šæ”¾ï¼Œå…±äº«é”çš„è·å–å’Œé‡Šæ”¾ä»¥åŠå¯ä¸­æ–­é”ï¼Œè¶…æ—¶ç­‰å¾…é”è·å–è¿™äº›ç‰¹æ€§çš„å®ç°")]),e._v("ï¼Œè€Œè¿™äº›å®é™…ä¸Šåˆ™æ˜¯AQSæä¾›å‡ºæ¥çš„æ¨¡æ¿æ–¹æ³•ï¼Œå½’çº³æ•´ç†å¦‚ä¸‹ï¼š")]),e._v(" "),n("p",[n("strong",[e._v("ç‹¬å å¼é”ï¼š")])]),e._v(" "),n("blockquote",[n("ul",[n("li",[e._v("void acquire(int arg)ï¼šç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–å¤±è´¥åˆ™æ’å…¥åŒæ­¥é˜Ÿåˆ—è¿›è¡Œç­‰å¾…ï¼›")]),e._v(" "),n("li",[e._v("void acquireInterruptibly(int arg)ï¼šä¸acquireæ–¹æ³•ç›¸åŒï¼Œä½†åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…çš„æ—¶å€™å¯ä»¥æ£€æµ‹ä¸­æ–­ï¼›")]),e._v(" "),n("li",[e._v("boolean tryAcquireNanos(int arg, long nanosTimeout)ï¼šåœ¨acquireInterruptiblyåŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶ç­‰å¾…åŠŸèƒ½ï¼Œåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰è·å¾—åŒæ­¥çŠ¶æ€è¿”å›false;")]),e._v(" "),n("li",[e._v("boolean release(int arg)ï¼šé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œè¯¥æ–¹æ³•ä¼šå”¤é†’åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹")])])]),e._v(" "),n("p",[n("strong",[e._v("å…±äº«å¼é”ï¼š")])]),e._v(" "),n("blockquote",[n("ul",[n("li",[e._v("void acquireShared(int arg)ï¼šå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œä¸ç‹¬å å¼çš„åŒºåˆ«åœ¨äºåŒä¸€æ—¶åˆ»æœ‰å¤šä¸ªçº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€ï¼›")]),e._v(" "),n("li",[e._v("void acquireSharedInterruptibly(int arg)ï¼šåœ¨acquireSharedæ–¹æ³•åŸºç¡€ä¸Šå¢åŠ äº†èƒ½å“åº”ä¸­æ–­çš„åŠŸèƒ½ï¼›")]),e._v(" "),n("li",[e._v("boolean tryAcquireSharedNanos(int arg, long nanosTimeout)ï¼šåœ¨acquireSharedInterruptiblyåŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶ç­‰å¾…çš„åŠŸèƒ½ï¼›")]),e._v(" "),n("li",[e._v("boolean releaseShared(int arg)ï¼šå…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€")])])]),e._v(" "),n("p",[e._v("è¦æƒ³æŒæ¡AQSçš„åº•å±‚å®ç°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯¹è¿™äº›æ¨¡æ¿æ–¹æ³•çš„é€»è¾‘è¿›è¡Œå­¦ä¹ ã€‚åœ¨å­¦ä¹ è¿™äº›æ¨¡æ¿æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—é¦–å…ˆäº†è§£ä¸‹AQSä¸­çš„åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºåŒæ­¥é˜Ÿåˆ—æ˜¯AQSå¯¹åŒæ­¥çŠ¶æ€çš„ç®¡ç†çš„åŸºçŸ³ã€‚")]),e._v(" "),n("h2",{attrs:{id:"_2-åŒæ­¥é˜Ÿåˆ—"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-åŒæ­¥é˜Ÿåˆ—"}},[e._v("#")]),e._v(" 2. åŒæ­¥é˜Ÿåˆ—")]),e._v(" "),n("p",[e._v("å½“å…±äº«èµ„æºè¢«æŸä¸ªçº¿ç¨‹å æœ‰ï¼Œå…¶ä»–è¯·æ±‚è¯¥èµ„æºçš„çº¿ç¨‹å°†ä¼šé˜»å¡ï¼Œä»è€Œè¿›å…¥åŒæ­¥é˜Ÿåˆ—ã€‚å°±æ•°æ®ç»“æ„è€Œè¨€ï¼Œé˜Ÿåˆ—çš„å®ç°æ–¹å¼æ— å¤–ä¹ä¸¤è€…ä¸€æ˜¯é€šè¿‡æ•°ç»„çš„å½¢å¼ï¼Œå¦å¤–ä¸€ç§åˆ™æ˜¯é“¾è¡¨çš„å½¢å¼ã€‚AQSä¸­çš„åŒæ­¥é˜Ÿåˆ—åˆ™æ˜¯"),n("strong",[e._v("é€šè¿‡é“¾å¼æ–¹å¼")]),e._v("è¿›è¡Œå®ç°ã€‚æ¥ä¸‹æ¥ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ä»¬è‡³å°‘ä¼šæŠ±æœ‰è¿™æ ·çš„ç–‘é—®ï¼š**1. èŠ‚ç‚¹çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ2. æ˜¯å•å‘è¿˜æ˜¯åŒå‘ï¼Ÿ3. æ˜¯å¸¦å¤´ç»“ç‚¹çš„è¿˜æ˜¯ä¸å¸¦å¤´èŠ‚ç‚¹çš„ï¼Ÿ**æˆ‘ä»¬ä¾æ—§å…ˆæ˜¯é€šè¿‡çœ‹æºç çš„æ–¹å¼ã€‚")]),e._v(" "),n("p",[e._v("åœ¨AQSæœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Nodeï¼Œå…¶ä¸­æœ‰è¿™æ ·ä¸€äº›å±æ€§ï¼š")]),e._v(" "),n("blockquote",[n("ul",[n("li",[e._v("volatile int waitStatus //èŠ‚ç‚¹çŠ¶æ€")]),e._v(" "),n("li",[e._v("volatile Node prev //å½“å‰èŠ‚ç‚¹/çº¿ç¨‹çš„å‰é©±èŠ‚ç‚¹")]),e._v(" "),n("li",[e._v("volatile Node next; //å½“å‰èŠ‚ç‚¹/çº¿ç¨‹çš„åç»§èŠ‚ç‚¹")]),e._v(" "),n("li",[e._v("volatile Thread thread;//åŠ å…¥åŒæ­¥é˜Ÿåˆ—çš„çº¿ç¨‹å¼•ç”¨")]),e._v(" "),n("li",[e._v("Node nextWaiter;//ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹")])])]),e._v(" "),n("p",[e._v("èŠ‚ç‚¹çš„çŠ¶æ€æœ‰ä»¥ä¸‹è¿™äº›ï¼š")]),e._v(" "),n("blockquote",[n("ul",[n("li",[e._v("int CANCELLED =  1//èŠ‚ç‚¹ä»åŒæ­¥é˜Ÿåˆ—ä¸­å–æ¶ˆ")]),e._v(" "),n("li",[e._v("int SIGNAL    = -1//åç»§èŠ‚ç‚¹çš„çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹é‡Šæ”¾åŒæ­¥çŠ¶æ€ä¼šé€šçŸ¥åç»§èŠ‚ç‚¹ï¼Œä½¿å¾—åç»§èŠ‚ç‚¹çš„çº¿ç¨‹èƒ½å¤Ÿè¿è¡Œï¼›")]),e._v(" "),n("li",[e._v("int CONDITION = -2//å½“å‰èŠ‚ç‚¹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­")]),e._v(" "),n("li",[e._v("int PROPAGATE = -3//è¡¨ç¤ºä¸‹ä¸€æ¬¡å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–å°†ä¼šæ— æ¡ä»¶ä¼ æ’­ä¸‹å»")]),e._v(" "),n("li",[e._v("int INITIAL = 0;//åˆå§‹çŠ¶æ€")])])]),e._v(" "),n("p",[e._v("ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ç±»å‹ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰å…¶å‰é©±å’Œåç»§èŠ‚ç‚¹ï¼Œå¾ˆæ˜¾ç„¶è¿™æ˜¯"),n("strong",[e._v("ä¸€ä¸ªåŒå‘é˜Ÿåˆ—")]),e._v("ã€‚åŒæ ·çš„æˆ‘ä»¬å¯ä»¥ç”¨ä¸€æ®µdemoçœ‹ä¸€ä¸‹ã€‚")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public class LockDemo {\n    private static ReentrantLock lock = new ReentrantLock();\n\n    public static void main(String[] args) {\n        for (int i = 0; i < 5; i++) {\n            Thread thread = new Thread(() -> {\n                lock.lock();\n                try {\n                    Thread.sleep(10000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                } finally {\n                    lock.unlock();\n                }\n            });\n            thread.start();\n        }\n    }\n}\n")])])]),n("p",[e._v("å®ä¾‹ä»£ç ä¸­å¼€å¯äº†5ä¸ªçº¿ç¨‹ï¼Œå…ˆè·å–é”ä¹‹åå†ç¡çœ 10Sä¸­ï¼Œå®é™…ä¸Šè¿™é‡Œè®©çº¿ç¨‹ç¡çœ æ˜¯æƒ³æ¨¡æ‹Ÿå‡ºå½“çº¿ç¨‹æ— æ³•è·å–é”æ—¶è¿›å…¥åŒæ­¥é˜Ÿåˆ—çš„æƒ…å†µã€‚é€šè¿‡debugï¼Œå½“Thread-4ï¼ˆåœ¨æœ¬ä¾‹ä¸­æœ€åä¸€ä¸ªçº¿ç¨‹ï¼‰è·å–é”å¤±è´¥åè¿›å…¥åŒæ­¥æ—¶ï¼ŒAQSæ—¶ç°åœ¨çš„åŒæ­¥é˜Ÿåˆ—å¦‚å›¾æ‰€ç¤ºï¼š")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/163261637bcef7e2.png",alt:"LockDemo debugä¸‹ .png"}})]),e._v(" "),n("p",[e._v("Thread-0å…ˆè·å¾—é”åè¿›è¡Œç¡çœ ï¼Œå…¶ä»–çº¿ç¨‹ï¼ˆThread-1,Thread-2,Thread-3,Thread-4ï¼‰è·å–é”å¤±è´¥è¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹å‡ºæ¥æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸¤ä¸ªåŸŸï¼šprev(å‰é©±)å’Œnext(åç»§)ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹ç”¨æ¥ä¿å­˜è·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹å¼•ç”¨ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯ã€‚å¦å¤–AQSä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æˆå‘˜å˜é‡ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private transient volatile Node head;\nprivate transient volatile Node tail;\n")])])]),n("p",[e._v("ä¹Ÿå°±æ˜¯è¯´AQSå®é™…ä¸Šé€šè¿‡å¤´å°¾æŒ‡é’ˆæ¥ç®¡ç†åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶å®ç°åŒ…æ‹¬è·å–é”å¤±è´¥çš„çº¿ç¨‹è¿›è¡Œå…¥é˜Ÿï¼Œé‡Šæ”¾é”æ—¶å¯¹åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹è¿›è¡Œé€šçŸ¥ç­‰æ ¸å¿ƒæ–¹æ³•ã€‚å…¶ç¤ºæ„å›¾å¦‚ä¸‹ï¼š")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/163261637bb25796.png",alt:"é˜Ÿåˆ—ç¤ºæ„å›¾.png"}})]),e._v(" "),n("p",[e._v("é€šè¿‡å¯¹æºç çš„ç†è§£ä»¥åŠåšå®éªŒçš„æ–¹å¼ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çŸ¥é“è¿™æ ·å‡ ç‚¹ï¼š")]),e._v(" "),n("ol",[n("li",[n("strong",[e._v("èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ï¼Œå³AQSçš„é™æ€å†…éƒ¨ç±»Node,èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯")]),e._v("ï¼›")]),e._v(" "),n("li",[n("strong",[e._v("åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼ŒAQSé€šè¿‡æŒæœ‰å¤´å°¾æŒ‡é’ˆç®¡ç†åŒæ­¥é˜Ÿåˆ—")]),e._v("ï¼›")])]),e._v(" "),n("p",[e._v("é‚£ä¹ˆï¼ŒèŠ‚ç‚¹å¦‚ä½•è¿›è¡Œå…¥é˜Ÿå’Œå‡ºé˜Ÿæ˜¯æ€æ ·åšçš„äº†ï¼Ÿå®é™…ä¸Šè¿™å¯¹åº”ç€é”çš„è·å–å’Œé‡Šæ”¾ä¸¤ä¸ªæ“ä½œï¼šè·å–é”å¤±è´¥è¿›è¡Œå…¥é˜Ÿæ“ä½œï¼Œè·å–é”æˆåŠŸè¿›è¡Œå‡ºé˜Ÿæ“ä½œã€‚")]),e._v(" "),n("h2",{attrs:{id:"_3-ç‹¬å é”"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-ç‹¬å é”"}},[e._v("#")]),e._v(" 3. ç‹¬å é”")]),e._v(" "),n("h3",{attrs:{id:"_3-1-ç‹¬å é”çš„è·å–-acquireæ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-ç‹¬å é”çš„è·å–-acquireæ–¹æ³•"}},[e._v("#")]),e._v(" 3.1 ç‹¬å é”çš„è·å–ï¼ˆacquireæ–¹æ³•ï¼‰")]),e._v(" "),n("p",[e._v("æˆ‘ä»¬ç»§ç»­é€šè¿‡çœ‹æºç å’Œdebugçš„æ–¹å¼æ¥çœ‹ï¼Œè¿˜æ˜¯ä»¥ä¸Šé¢çš„demoä¸ºä¾‹ï¼Œè°ƒç”¨lock()æ–¹æ³•æ˜¯è·å–ç‹¬å å¼é”ï¼Œè·å–å¤±è´¥å°±å°†å½“å‰çº¿ç¨‹åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼ŒæˆåŠŸåˆ™çº¿ç¨‹æ‰§è¡Œã€‚è€Œlock()æ–¹æ³•å®é™…ä¸Šä¼šè°ƒç”¨AQSçš„**acquire()**æ–¹æ³•ï¼Œæºç å¦‚ä¸‹")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public final void acquire(int arg) {\n\t\t//å…ˆçœ‹åŒæ­¥çŠ¶æ€æ˜¯å¦è·å–æˆåŠŸï¼Œå¦‚æœæˆåŠŸåˆ™æ–¹æ³•ç»“æŸè¿”å›\n\t\t//è‹¥å¤±è´¥åˆ™å…ˆè°ƒç”¨addWaiter()æ–¹æ³•å†è°ƒç”¨acquireQueued()æ–¹æ³•\n        if (!tryAcquire(arg) &&\n            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n            selfInterrupt();\n}\n")])])]),n("p",[e._v("å…³é”®ä¿¡æ¯è¯·çœ‹æ³¨é‡Šï¼Œacquireæ ¹æ®å½“å‰è·å¾—åŒæ­¥çŠ¶æ€æˆåŠŸä¸å¦åšäº†ä¸¤ä»¶äº‹æƒ…ï¼š1. æˆåŠŸï¼Œåˆ™æ–¹æ³•ç»“æŸè¿”å›ï¼Œ2. å¤±è´¥ï¼Œåˆ™å…ˆè°ƒç”¨addWaiter()ç„¶ååœ¨è°ƒç”¨acquireQueued()æ–¹æ³•ã€‚")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("è·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œå…¥é˜Ÿæ“ä½œ")])])]),e._v(" "),n("p",[e._v("å½“çº¿ç¨‹è·å–ç‹¬å å¼é”å¤±è´¥åå°±ä¼šå°†å½“å‰çº¿ç¨‹åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œé‚£ä¹ˆåŠ å…¥é˜Ÿåˆ—çš„æ–¹å¼æ˜¯æ€æ ·çš„äº†ï¼Ÿæˆ‘ä»¬æ¥ä¸‹æ¥å°±åº”è¯¥å»ç ”ç©¶ä¸€ä¸‹addWaiter()å’ŒacquireQueued()ã€‚addWaiter()æºç å¦‚ä¸‹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private Node addWaiter(Node mode) {\n\t\t// 1. å°†å½“å‰çº¿ç¨‹æ„å»ºæˆNodeç±»å‹\n        Node node = new Node(Thread.currentThread(), mode);\n        // Try the fast path of enq; backup to full enq on failure\n        // 2. å½“å‰å°¾èŠ‚ç‚¹æ˜¯å¦ä¸ºnullï¼Ÿ\n\t\tNode pred = tail;\n        if (pred != null) {\n\t\t\t// 2.2 å°†å½“å‰èŠ‚ç‚¹å°¾æ’å…¥çš„æ–¹å¼æ’å…¥åŒæ­¥é˜Ÿåˆ—ä¸­\n            node.prev = pred;\n            if (compareAndSetTail(pred, node)) {\n                pred.next = node;\n                return node;\n            }\n        }\n\t\t// 2.1. å½“å‰åŒæ­¥é˜Ÿåˆ—å°¾èŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜å½“å‰çº¿ç¨‹æ˜¯ç¬¬ä¸€ä¸ªåŠ å…¥åŒæ­¥é˜Ÿåˆ—è¿›è¡Œç­‰å¾…çš„çº¿ç¨‹\n        enq(node);\n        return node;\n}\n")])])]),n("p",[e._v("åˆ†æå¯ä»¥çœ‹ä¸Šé¢çš„æ³¨é‡Šã€‚ç¨‹åºçš„é€»è¾‘ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š**1. å½“å‰åŒæ­¥é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ä¸ºnullï¼Œè°ƒç”¨æ–¹æ³•enq()æ’å…¥;2. å½“å‰é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ä¸ä¸ºnullï¼Œåˆ™é‡‡ç”¨å°¾æ’å…¥ï¼ˆcompareAndSetTailï¼ˆï¼‰æ–¹æ³•ï¼‰çš„æ–¹å¼å…¥é˜Ÿã€‚**å¦å¤–è¿˜ä¼šæœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœ "),n("code",[e._v("if (compareAndSetTail(pred, node))")]),e._v("ä¸ºfalseæ€ä¹ˆåŠï¼Ÿä¼šç»§ç»­æ‰§è¡Œåˆ°enq()æ–¹æ³•ï¼ŒåŒæ—¶å¾ˆæ˜æ˜¾compareAndSetTailæ˜¯ä¸€ä¸ªCASæ“ä½œï¼Œé€šå¸¸æ¥è¯´å¦‚æœCASæ“ä½œå¤±è´¥ä¼šç»§ç»­è‡ªæ—‹ï¼ˆæ­»å¾ªç¯ï¼‰è¿›è¡Œé‡è¯•ã€‚å› æ­¤ï¼Œç»è¿‡æˆ‘ä»¬è¿™æ ·çš„åˆ†æï¼Œenq()æ–¹æ³•å¯èƒ½æ‰¿æ‹…ä¸¤ä¸ªä»»åŠ¡ï¼š**1. å¤„ç†å½“å‰åŒæ­¥é˜Ÿåˆ—å°¾èŠ‚ç‚¹ä¸ºnullæ—¶è¿›è¡Œå…¥é˜Ÿæ“ä½œï¼›2. å¦‚æœCASå°¾æ’å…¥èŠ‚ç‚¹å¤±è´¥åè´Ÿè´£è‡ªæ—‹è¿›è¡Œå°è¯•ã€‚**é‚£ä¹ˆæ˜¯ä¸æ˜¯çœŸçš„å°±åƒæˆ‘ä»¬åˆ†æçš„ä¸€æ ·äº†ï¼Ÿåªæœ‰æºç ä¼šå‘Šè¯‰æˆ‘ä»¬ç­”æ¡ˆ:),enq()æºç å¦‚ä¸‹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private Node enq(final Node node) {\n        for (;;) {\n            Node t = tail;\n\t\t\tif (t == null) { // Must initialize\n\t\t\t\t//1. æ„é€ å¤´ç»“ç‚¹\n                if (compareAndSetHead(new Node()))\n                    tail = head;\n            } else {\n\t\t\t\t// 2. å°¾æ’å…¥ï¼ŒCASæ“ä½œå¤±è´¥è‡ªæ—‹å°è¯•\n                node.prev = t;\n                if (compareAndSetTail(t, node)) {\n                    t.next = node;\n                    return t;\n                }\n            }\n        }\n}\n")])])]),n("p",[e._v("åœ¨ä¸Šé¢çš„åˆ†æä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåœ¨ç¬¬1æ­¥ä¸­ä¼šå…ˆåˆ›å»ºå¤´ç»“ç‚¹ï¼Œè¯´æ˜åŒæ­¥é˜Ÿåˆ—æ˜¯"),n("strong",[e._v("å¸¦å¤´ç»“ç‚¹çš„é“¾å¼å­˜å‚¨ç»“æ„")]),e._v("ã€‚å¸¦å¤´ç»“ç‚¹ä¸ä¸å¸¦å¤´ç»“ç‚¹ç›¸æ¯”ï¼Œä¼šåœ¨å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ“ä½œä¸­è·å¾—æ›´å¤§çš„ä¾¿æ·æ€§ï¼Œå› æ­¤åŒæ­¥é˜Ÿåˆ—é€‰æ‹©äº†å¸¦å¤´ç»“ç‚¹çš„é“¾å¼å­˜å‚¨ç»“æ„ã€‚é‚£ä¹ˆå¸¦å¤´èŠ‚ç‚¹çš„é˜Ÿåˆ—åˆå§‹åŒ–æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿè‡ªç„¶è€Œç„¶æ˜¯åœ¨"),n("strong",[e._v("tailä¸ºnullæ—¶ï¼Œå³å½“å‰çº¿ç¨‹æ˜¯ç¬¬ä¸€æ¬¡æ’å…¥åŒæ­¥é˜Ÿåˆ—")]),e._v("ã€‚compareAndSetTail(t, node)æ–¹æ³•ä¼šåˆ©ç”¨CASæ“ä½œè®¾ç½®å°¾èŠ‚ç‚¹ï¼Œå¦‚æœCASæ“ä½œå¤±è´¥ä¼šåœ¨"),n("code",[e._v("for (;;)")]),e._v("foræ­»å¾ªç¯ä¸­ä¸æ–­å°è¯•ï¼Œç›´è‡³æˆåŠŸreturnè¿”å›ä¸ºæ­¢ã€‚å› æ­¤ï¼Œå¯¹enq()æ–¹æ³•å¯ä»¥åšè¿™æ ·çš„æ€»ç»“ï¼š")]),e._v(" "),n("ol",[n("li",[n("strong",[e._v("åœ¨å½“å‰çº¿ç¨‹æ˜¯ç¬¬ä¸€ä¸ªåŠ å…¥åŒæ­¥é˜Ÿåˆ—æ—¶ï¼Œè°ƒç”¨compareAndSetHead(new Node())æ–¹æ³•ï¼Œå®Œæˆé“¾å¼é˜Ÿåˆ—çš„å¤´ç»“ç‚¹çš„åˆå§‹åŒ–")]),e._v("ï¼›")]),e._v(" "),n("li",[n("strong",[e._v("è‡ªæ—‹ä¸æ–­å°è¯•CASå°¾æ’å…¥èŠ‚ç‚¹ç›´è‡³æˆåŠŸä¸ºæ­¢")]),e._v("ã€‚")])]),e._v(" "),n("p",[e._v("ç°åœ¨æˆ‘ä»¬å·²ç»å¾ˆæ¸…æ¥šè·å–ç‹¬å å¼é”å¤±è´¥çš„çº¿ç¨‹åŒ…è£…æˆNodeç„¶åæ’å…¥åŒæ­¥é˜Ÿåˆ—çš„è¿‡ç¨‹äº†ï¼Ÿé‚£ä¹ˆç´§æ¥ç€ä¼šæœ‰ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Ÿåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ï¼ˆçº¿ç¨‹ï¼‰ä¼šåšä»€ä¹ˆäº‹æƒ…äº†æ¥ä¿è¯è‡ªå·±èƒ½å¤Ÿæœ‰æœºä¼šè·å¾—ç‹¬å å¼é”äº†ï¼Ÿå¸¦ç€è¿™æ ·çš„é—®é¢˜æˆ‘ä»¬å°±æ¥çœ‹çœ‹acquireQueued()æ–¹æ³•ï¼Œä»æ–¹æ³•åå°±å¯ä»¥å¾ˆæ¸…æ¥šï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯æ’é˜Ÿè·å–é”çš„è¿‡ç¨‹ï¼Œæºç å¦‚ä¸‹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("final boolean acquireQueued(final Node node, int arg) {\n        boolean failed = true;\n        try {\n            boolean interrupted = false;\n            for (;;) {\n\t\t\t\t// 1. è·å¾—å½“å‰èŠ‚ç‚¹çš„å…ˆé©±èŠ‚ç‚¹\n                final Node p = node.predecessor();\n\t\t\t\t// 2. å½“å‰èŠ‚ç‚¹èƒ½å¦è·å–ç‹¬å å¼é”\t\t\t\t\t\n\t\t\t\t// 2.1 å¦‚æœå½“å‰èŠ‚ç‚¹çš„å…ˆé©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹å¹¶ä¸”æˆåŠŸè·å–åŒæ­¥çŠ¶æ€ï¼Œå³å¯ä»¥è·å¾—ç‹¬å å¼é”\n                if (p == head && tryAcquire(arg)) {\n\t\t\t\t\t//é˜Ÿåˆ—å¤´æŒ‡é’ˆç”¨æŒ‡å‘å½“å‰èŠ‚ç‚¹\n                    setHead(node);\n\t\t\t\t\t//é‡Šæ”¾å‰é©±èŠ‚ç‚¹\n                    p.next = null; // help GC\n                    failed = false;\n                    return interrupted;\n                }\n\t\t\t\t// 2.2 è·å–é”å¤±è´¥ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ç­‰å¾…è·å–ç‹¬å å¼é”\n                if (shouldParkAfterFailedAcquire(p, node) &&\n                    parkAndCheckInterrupt())\n                    interrupted = true;\n            }\n        } finally {\n            if (failed)\n                cancelAcquire(node);\n        }\n}\n")])])]),n("p",[e._v("ç¨‹åºé€»è¾‘é€šè¿‡æ³¨é‡Šå·²ç»æ ‡å‡ºï¼Œæ•´ä½“æ¥çœ‹è¿™æ˜¯ä¸€ä¸ªè¿™åˆæ˜¯ä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼ˆfor (;ğŸ˜‰ï¼‰ï¼Œä»£ç é¦–å…ˆè·å–å½“å‰èŠ‚ç‚¹çš„å…ˆé©±èŠ‚ç‚¹ï¼Œ"),n("strong",[e._v("å¦‚æœå…ˆé©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹çš„å¹¶ä¸”æˆåŠŸè·å¾—åŒæ­¥çŠ¶æ€çš„æ—¶å€™ï¼ˆif (p == head && tryAcquire(arg))ï¼‰ï¼Œå½“å‰èŠ‚ç‚¹æ‰€æŒ‡å‘çš„çº¿ç¨‹èƒ½å¤Ÿè·å–é”")]),e._v("ã€‚åä¹‹ï¼Œè·å–é”å¤±è´¥è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚æ•´ä½“ç¤ºæ„å›¾ä¸ºä¸‹å›¾ï¼š")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/163261637c5fc765.png",alt:"è‡ªæ—‹è·å–é”æ•´ä½“ç¤ºæ„å›¾.png"}})]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("è·å–é”æˆåŠŸï¼Œå‡ºé˜Ÿæ“ä½œ")])])]),e._v(" "),n("p",[e._v("è·å–é”çš„èŠ‚ç‚¹å‡ºé˜Ÿçš„é€»è¾‘æ˜¯ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("//é˜Ÿåˆ—å¤´ç»“ç‚¹å¼•ç”¨æŒ‡å‘å½“å‰èŠ‚ç‚¹\nsetHead(node);\n//é‡Šæ”¾å‰é©±èŠ‚ç‚¹\np.next = null; // help GC\nfailed = false;\nreturn interrupted;\n")])])]),n("p",[e._v("setHead()æ–¹æ³•ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private void setHead(Node node) {\n        head = node;\n        node.thread = null;\n        node.prev = null;\n}\n")])])]),n("p",[e._v("å°†å½“å‰èŠ‚ç‚¹é€šè¿‡setHead()æ–¹æ³•è®¾ç½®ä¸ºé˜Ÿåˆ—çš„å¤´ç»“ç‚¹ï¼Œç„¶åå°†ä¹‹å‰çš„å¤´ç»“ç‚¹çš„nextåŸŸè®¾ç½®ä¸ºnullå¹¶ä¸”preåŸŸä¹Ÿä¸ºnullï¼Œå³ä¸é˜Ÿåˆ—æ–­å¼€ï¼Œæ— ä»»ä½•å¼•ç”¨æ–¹ä¾¿GCæ—¶èƒ½å¤Ÿå°†å†…å­˜è¿›è¡Œå›æ”¶ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/5/3/163261637c63a47a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"å½“å‰èŠ‚ç‚¹å¼•ç”¨çº¿ç¨‹è·å–é”ï¼Œå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºé˜Ÿåˆ—å¤´ç»“ç‚¹.png"}})]),e._v(" "),n("p",[e._v("é‚£ä¹ˆå½“è·å–é”å¤±è´¥çš„æ—¶å€™ä¼šè°ƒç”¨shouldParkAfterFailedAcquire()æ–¹æ³•å’ŒparkAndCheckInterrupt()æ–¹æ³•ï¼Œçœ‹çœ‹ä»–ä»¬åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚shouldParkAfterFailedAcquire()æ–¹æ³•æºç ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n    int ws = pred.waitStatus;\n    if (ws == Node.SIGNAL)\n        /*\n         * This node has already set status asking a release\n         * to signal it, so it can safely park.\n         */\n        return true;\n    if (ws > 0) {\n        /*\n         * Predecessor was cancelled. Skip over predecessors and\n         * indicate retry.\n         */\n        do {\n            node.prev = pred = pred.prev;\n        } while (pred.waitStatus > 0);\n        pred.next = node;\n    } else {\n        /*\n         * waitStatus must be 0 or PROPAGATE.  Indicate that we\n         * need a signal, but don't park yet.  Caller will need to\n         * retry to make sure it cannot acquire before parking.\n         */\n        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n    }\n    return false;\n}\n")])])]),n("p",[e._v("shouldParkAfterFailedAcquire()æ–¹æ³•ä¸»è¦é€»è¾‘æ˜¯ä½¿ç”¨"),n("code",[e._v("compareAndSetWaitStatus(pred, ws, Node.SIGNAL)")]),e._v("ä½¿ç”¨CASå°†èŠ‚ç‚¹çŠ¶æ€ç”±INITIALè®¾ç½®æˆSIGNALï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹é˜»å¡ã€‚å½“compareAndSetWaitStatusè®¾ç½®å¤±è´¥åˆ™è¯´æ˜shouldParkAfterFailedAcquireæ–¹æ³•è¿”å›falseï¼Œç„¶åä¼šåœ¨acquireQueued()æ–¹æ³•ä¸­for (;;)æ­»å¾ªç¯ä¸­ä¼šç»§ç»­é‡è¯•ï¼Œç›´è‡³compareAndSetWaitStatusè®¾ç½®èŠ‚ç‚¹çŠ¶æ€ä½ä¸ºSIGNALæ—¶shouldParkAfterFailedAcquireè¿”å›trueæ—¶æ‰ä¼šæ‰§è¡Œæ–¹æ³•parkAndCheckInterrupt()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„æºç ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private final boolean parkAndCheckInterrupt() {\n        //ä½¿å¾—è¯¥çº¿ç¨‹é˜»å¡\n\t\tLockSupport.park(this);\n        return Thread.interrupted();\n}\n")])])]),n("p",[e._v("è¯¥æ–¹æ³•çš„å…³é”®æ˜¯ä¼šè°ƒç”¨LookSupport.park()æ–¹æ³•ï¼ˆå…³äºLookSupportä¼šåœ¨ä»¥åçš„æ–‡ç« è¿›è¡Œè®¨è®ºï¼‰ï¼Œè¯¥æ–¹æ³•æ˜¯ç”¨æ¥é˜»å¡å½“å‰çº¿ç¨‹çš„ã€‚å› æ­¤åˆ°è¿™é‡Œå°±åº”è¯¥æ¸…æ¥šäº†ï¼ŒacquireQueued()åœ¨è‡ªæ—‹è¿‡ç¨‹ä¸­ä¸»è¦å®Œæˆäº†ä¸¤ä»¶äº‹æƒ…ï¼š")]),e._v(" "),n("ol",[n("li",[n("strong",[e._v("å¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿè·å¾—åŒæ­¥çŠ¶æ€çš„è¯ï¼Œå½“å‰çº¿ç¨‹èƒ½å¤Ÿè·å¾—é”è¯¥æ–¹æ³•æ‰§è¡Œç»“æŸé€€å‡º")]),e._v("ï¼›")]),e._v(" "),n("li",[n("strong",[e._v("è·å–é”å¤±è´¥çš„è¯ï¼Œå…ˆå°†èŠ‚ç‚¹çŠ¶æ€è®¾ç½®æˆSIGNALï¼Œç„¶åè°ƒç”¨LookSupport.parkæ–¹æ³•ä½¿å¾—å½“å‰çº¿ç¨‹é˜»å¡")]),e._v("ã€‚")])]),e._v(" "),n("p",[e._v("ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œç‹¬å å¼é”çš„è·å–è¿‡ç¨‹ä¹Ÿå°±æ˜¯acquire()æ–¹æ³•çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/5/3/163261637c891cc2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"ç‹¬å å¼é”è·å–ï¼ˆacquire()æ–¹æ³•ï¼‰æµç¨‹å›¾.png"}})]),e._v(" "),n("h3",{attrs:{id:"_3-2-ç‹¬å é”çš„é‡Šæ”¾-release-æ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-ç‹¬å é”çš„é‡Šæ”¾-release-æ–¹æ³•"}},[e._v("#")]),e._v(" 3.2 ç‹¬å é”çš„é‡Šæ”¾ï¼ˆrelease()æ–¹æ³•ï¼‰")]),e._v(" "),n("p",[e._v("ç‹¬å é”çš„é‡Šæ”¾å°±ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼ŒåºŸè¯ä¸å¤šè¯´å…ˆæ¥çœ‹ä¸‹æºç ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public final boolean release(int arg) {\n        if (tryRelease(arg)) {\n            Node h = head;\n            if (h != null && h.waitStatus != 0)\n                unparkSuccessor(h);\n            return true;\n        }\n        return false;\n}\n")])])]),n("p",[e._v("è¿™æ®µä»£ç é€»è¾‘å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼Œå¦‚æœåŒæ­¥çŠ¶æ€é‡Šæ”¾æˆåŠŸï¼ˆtryReleaseè¿”å›trueï¼‰åˆ™ä¼šæ‰§è¡Œifå—ä¸­çš„ä»£ç ï¼Œå½“headæŒ‡å‘çš„å¤´ç»“ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹çš„çŠ¶æ€å€¼ä¸ä¸º0çš„è¯æ‰ä¼šæ‰§è¡ŒunparkSuccessor()æ–¹æ³•ã€‚unparkSuccessoræ–¹æ³•æºç ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private void unparkSuccessor(Node node) {\n    /*\n     * If status is negative (i.e., possibly needing signal) try\n     * to clear in anticipation of signalling.  It is OK if this\n     * fails or if status is changed by waiting thread.\n     */\n    int ws = node.waitStatus;\n    if (ws < 0)\n        compareAndSetWaitStatus(node, ws, 0);\n\n    /*\n     * Thread to unpark is held in successor, which is normally\n     * just the next node.  But if cancelled or apparently null,\n     * traverse backwards from tail to find the actual\n     * non-cancelled successor.\n     */\n\n\t//å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹\n    Node s = node.next;\n    if (s == null || s.waitStatus > 0) {\n        s = null;\n        for (Node t = tail; t != null && t != node; t = t.prev)\n            if (t.waitStatus <= 0)\n                s = t;\n    }\n    if (s != null)\n\t\t//åç»§èŠ‚ç‚¹ä¸ä¸ºnullæ—¶å”¤é†’è¯¥çº¿ç¨‹\n        LockSupport.unpark(s.thread);\n}\n")])])]),n("p",[e._v("æºç çš„å…³é”®ä¿¡æ¯è¯·çœ‹æ³¨é‡Šï¼Œé¦–å…ˆè·å–å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ï¼Œå½“åç»§èŠ‚ç‚¹çš„æ—¶å€™ä¼šè°ƒç”¨LookSupport.unpark()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå”¤é†’è¯¥èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æ‰€åŒ…è£…çš„çº¿ç¨‹ã€‚å› æ­¤ï¼Œ"),n("strong",[e._v("æ¯ä¸€æ¬¡é”é‡Šæ”¾åå°±ä¼šå”¤é†’é˜Ÿåˆ—ä¸­è¯¥èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æ‰€å¼•ç”¨çš„çº¿ç¨‹ï¼Œä»è€Œè¿›ä¸€æ­¥å¯ä»¥ä½è¯è·å¾—é”çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„è¿‡ç¨‹ã€‚")])]),e._v(" "),n("p",[e._v("åˆ°ç°åœ¨æˆ‘ä»¬ç»ˆäºå•ƒä¸‹äº†ä¸€å—ç¡¬éª¨å¤´äº†ï¼Œé€šè¿‡å­¦ä¹ æºç çš„æ–¹å¼éå¸¸æ·±åˆ»çš„å­¦ä¹ åˆ°äº†ç‹¬å å¼é”çš„è·å–å’Œé‡Šæ”¾çš„è¿‡ç¨‹ä»¥åŠåŒæ­¥é˜Ÿåˆ—ã€‚å¯ä»¥åšä¸€ä¸‹æ€»ç»“ï¼š")]),e._v(" "),n("ol",[n("li",[n("strong",[e._v("çº¿ç¨‹è·å–é”å¤±è´¥ï¼Œçº¿ç¨‹è¢«å°è£…æˆNodeè¿›è¡Œå…¥é˜Ÿæ“ä½œï¼Œæ ¸å¿ƒæ–¹æ³•åœ¨äºaddWaiter()å’Œenq()ï¼ŒåŒæ—¶enq()å®Œæˆå¯¹åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹åˆå§‹åŒ–å·¥ä½œä»¥åŠCASæ“ä½œå¤±è´¥çš„é‡è¯•")]),e._v(";")]),e._v(" "),n("li",[n("strong",[e._v("çº¿ç¨‹è·å–é”æ˜¯ä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼Œå½“ä¸”ä»…å½“ å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹å¹¶ä¸”æˆåŠŸè·å¾—åŒæ­¥çŠ¶æ€æ—¶ï¼ŒèŠ‚ç‚¹å‡ºé˜Ÿå³è¯¥èŠ‚ç‚¹å¼•ç”¨çš„çº¿ç¨‹è·å¾—é”ï¼Œå¦åˆ™ï¼Œå½“ä¸æ»¡è¶³æ¡ä»¶æ—¶å°±ä¼šè°ƒç”¨LookSupport.park()æ–¹æ³•ä½¿å¾—çº¿ç¨‹é˜»å¡")]),e._v("ï¼›")]),e._v(" "),n("li",[n("strong",[e._v("é‡Šæ”¾é”çš„æ—¶å€™ä¼šå”¤é†’åç»§èŠ‚ç‚¹ï¼›")])])]),e._v(" "),n("p",[e._v("æ€»ä½“æ¥è¯´ï¼š"),n("strong",[e._v("åœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶ï¼ŒAQSç»´æŠ¤ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œè·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹ä¼šåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­è¿›è¡Œè‡ªæ—‹ï¼›ç§»é™¤é˜Ÿåˆ—ï¼ˆæˆ–åœæ­¢è‡ªæ—‹ï¼‰çš„æ¡ä»¶æ˜¯å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹å¹¶ä¸”æˆåŠŸè·å¾—äº†åŒæ­¥çŠ¶æ€ã€‚åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼ŒåŒæ­¥å™¨ä¼šè°ƒç”¨unparkSuccessor()æ–¹æ³•å”¤é†’åç»§èŠ‚ç‚¹ã€‚")])]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("ç‹¬å é”ç‰¹æ€§å­¦ä¹ ")])])]),e._v(" "),n("h3",{attrs:{id:"_3-3-å¯ä¸­æ–­å¼è·å–é”-acquireinterruptiblyæ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-å¯ä¸­æ–­å¼è·å–é”-acquireinterruptiblyæ–¹æ³•"}},[e._v("#")]),e._v(" 3.3 å¯ä¸­æ–­å¼è·å–é”ï¼ˆacquireInterruptiblyæ–¹æ³•ï¼‰")]),e._v(" "),n("p",[e._v("æˆ‘ä»¬çŸ¥é“lockç›¸è¾ƒäºsynchronizedæœ‰ä¸€äº›æ›´æ–¹ä¾¿çš„ç‰¹æ€§ï¼Œæ¯”å¦‚èƒ½å“åº”ä¸­æ–­ä»¥åŠè¶…æ—¶ç­‰å¾…ç­‰ç‰¹æ€§ï¼Œç°åœ¨æˆ‘ä»¬ä¾æ—§é‡‡ç”¨é€šè¿‡å­¦ä¹ æºç çš„æ–¹å¼æ¥çœ‹çœ‹èƒ½å¤Ÿå“åº”ä¸­æ–­æ˜¯æ€ä¹ˆå®ç°çš„ã€‚å¯å“åº”ä¸­æ–­å¼é”å¯è°ƒç”¨æ–¹æ³•lock.lockInterruptibly();è€Œè¯¥æ–¹æ³•å…¶åº•å±‚ä¼šè°ƒç”¨AQSçš„acquireInterruptiblyæ–¹æ³•ï¼Œæºç ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public final void acquireInterruptibly(int arg)\n        throws InterruptedException {\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    if (!tryAcquire(arg))\n\t\t//çº¿ç¨‹è·å–é”å¤±è´¥\n        doAcquireInterruptibly(arg);\n}\n")])])]),n("p",[e._v("åœ¨è·å–åŒæ­¥çŠ¶æ€å¤±è´¥åå°±ä¼šè°ƒç”¨doAcquireInterruptiblyæ–¹æ³•ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private void doAcquireInterruptibly(int arg)\n    throws InterruptedException {\n\t//å°†èŠ‚ç‚¹æ’å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­\n    final Node node = addWaiter(Node.EXCLUSIVE);\n    boolean failed = true;\n    try {\n        for (;;) {\n            final Node p = node.predecessor();\n            //è·å–é”å‡ºé˜Ÿ\n\t\t\tif (p == head && tryAcquire(arg)) {\n                setHead(node);\n                p.next = null; // help GC\n                failed = false;\n                return;\n            }\n            if (shouldParkAfterFailedAcquire(p, node) &&\n                parkAndCheckInterrupt())\n\t\t\t\t//çº¿ç¨‹ä¸­æ–­æŠ›å¼‚å¸¸\n                throw new InterruptedException();\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n")])])]),n("p",[e._v("å…³é”®ä¿¡æ¯è¯·çœ‹æ³¨é‡Šï¼Œç°åœ¨çœ‹è¿™æ®µä»£ç å°±å¾ˆè½»æ¾äº†å§:),ä¸acquireæ–¹æ³•é€»è¾‘å‡ ä¹ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å½“"),n("strong",[e._v("parkAndCheckInterrupt")]),e._v("è¿”å›trueæ—¶å³çº¿ç¨‹é˜»å¡æ—¶è¯¥çº¿ç¨‹è¢«ä¸­æ–­ï¼Œä»£ç æŠ›å‡ºè¢«ä¸­æ–­å¼‚å¸¸ã€‚")]),e._v(" "),n("h3",{attrs:{id:"_3-4-è¶…æ—¶ç­‰å¾…å¼è·å–é”-tryacquirenanos-æ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-è¶…æ—¶ç­‰å¾…å¼è·å–é”-tryacquirenanos-æ–¹æ³•"}},[e._v("#")]),e._v(" 3.4 è¶…æ—¶ç­‰å¾…å¼è·å–é”ï¼ˆtryAcquireNanos()æ–¹æ³•ï¼‰")]),e._v(" "),n("p",[e._v("é€šè¿‡è°ƒç”¨lock.tryLock(timeout,TimeUnit)æ–¹å¼è¾¾åˆ°è¶…æ—¶ç­‰å¾…è·å–é”çš„æ•ˆæœï¼Œè¯¥æ–¹æ³•ä¼šåœ¨ä¸‰ç§æƒ…å†µä¸‹æ‰ä¼šè¿”å›ï¼š")]),e._v(" "),n("ol",[n("li",[e._v("åœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè·å–äº†é”ï¼›")]),e._v(" "),n("li",[e._v("å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­ï¼›")]),e._v(" "),n("li",[e._v("è¶…æ—¶æ—¶é—´ç»“æŸï¼Œä»æœªè·å¾—é”è¿”å›falseã€‚")])]),e._v(" "),n("p",[e._v("æˆ‘ä»¬ä»ç„¶é€šè¿‡é‡‡å–é˜…è¯»æºç çš„æ–¹å¼æ¥å­¦ä¹ åº•å±‚å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨AQSçš„æ–¹æ³•tryAcquireNanos(),æºç ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public final boolean tryAcquireNanos(int arg, long nanosTimeout)\n        throws InterruptedException {\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    return tryAcquire(arg) ||\n\t\t//å®ç°è¶…æ—¶ç­‰å¾…çš„æ•ˆæœ\n        doAcquireNanos(arg, nanosTimeout);\n}\n")])])]),n("p",[e._v("å¾ˆæ˜¾ç„¶è¿™æ®µæºç æœ€ç»ˆæ˜¯é doAcquireNanosæ–¹æ³•å®ç°è¶…æ—¶ç­‰å¾…çš„æ•ˆæœï¼Œè¯¥æ–¹æ³•æºç å¦‚ä¸‹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private boolean doAcquireNanos(int arg, long nanosTimeout)\n        throws InterruptedException {\n    if (nanosTimeout <= 0L)\n        return false;\n\t//1. æ ¹æ®è¶…æ—¶æ—¶é—´å’Œå½“å‰æ—¶é—´è®¡ç®—å‡ºæˆªæ­¢æ—¶é—´\n    final long deadline = System.nanoTime() + nanosTimeout;\n    final Node node = addWaiter(Node.EXCLUSIVE);\n    boolean failed = true;\n    try {\n        for (;;) {\n            final Node p = node.predecessor();\n\t\t\t//2. å½“å‰çº¿ç¨‹è·å¾—é”å‡ºé˜Ÿåˆ—\n            if (p == head && tryAcquire(arg)) {\n                setHead(node);\n                p.next = null; // help GC\n                failed = false;\n                return true;\n            }\n\t\t\t// 3.1 é‡æ–°è®¡ç®—è¶…æ—¶æ—¶é—´\n            nanosTimeout = deadline - System.nanoTime();\n            // 3.2 å·²ç»è¶…æ—¶è¿”å›false\n\t\t\tif (nanosTimeout <= 0L)\n                return false;\n\t\t\t// 3.3 çº¿ç¨‹é˜»å¡ç­‰å¾… \n            if (shouldParkAfterFailedAcquire(p, node) &&\n                nanosTimeout > spinForTimeoutThreshold)\n                LockSupport.parkNanos(this, nanosTimeout);\n            // 3.4 çº¿ç¨‹è¢«ä¸­æ–­æŠ›å‡ºè¢«ä¸­æ–­å¼‚å¸¸\n\t\t\tif (Thread.interrupted())\n                throw new InterruptedException();\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n")])])]),n("p",[e._v("ç¨‹åºé€»è¾‘å¦‚å›¾æ‰€ç¤ºï¼š")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/5/3/163261637d087f5e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"è¶…æ—¶ç­‰å¾…å¼è·å–é”ï¼ˆdoAcquireNanos()æ–¹æ³•ï¼‰"}})]),e._v(" "),n("p",[e._v("ç¨‹åºé€»è¾‘åŒç‹¬å é”å¯å“åº”ä¸­æ–­å¼è·å–åŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äºè·å–é”å¤±è´¥åï¼Œå¯¹è¶…æ—¶æ—¶é—´çš„å¤„ç†ä¸Šï¼Œåœ¨ç¬¬1æ­¥ä¼šå…ˆè®¡ç®—å‡ºæŒ‰ç…§ç°åœ¨æ—¶é—´å’Œè¶…æ—¶æ—¶é—´è®¡ç®—å‡ºç†è®ºä¸Šçš„æˆªæ­¢æ—¶é—´ï¼Œæ¯”å¦‚å½“å‰æ—¶é—´æ˜¯8h10min,è¶…æ—¶æ—¶é—´æ˜¯10minï¼Œé‚£ä¹ˆæ ¹æ®"),n("code",[e._v("deadline = System.nanoTime() + nanosTimeout")]),e._v("è®¡ç®—å‡ºåˆšå¥½è¾¾åˆ°è¶…æ—¶æ—¶é—´æ—¶çš„ç³»ç»Ÿæ—¶é—´å°±æ˜¯8h 10min+10min = 8h 20minã€‚ç„¶åæ ¹æ®"),n("code",[e._v("deadline - System.nanoTime()")]),e._v("å°±å¯ä»¥åˆ¤æ–­æ˜¯å¦å·²ç»è¶…æ—¶äº†ï¼Œæ¯”å¦‚ï¼Œå½“å‰ç³»ç»Ÿæ—¶é—´æ˜¯8h 30minå¾ˆæ˜æ˜¾å·²ç»è¶…è¿‡äº†ç†è®ºä¸Šçš„ç³»ç»Ÿæ—¶é—´8h 20minï¼Œ"),n("code",[e._v("deadline - System.nanoTime()")]),e._v("è®¡ç®—å‡ºæ¥å°±æ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œè‡ªç„¶è€Œç„¶ä¼šåœ¨3.2æ­¥ä¸­çš„Ifåˆ¤æ–­ä¹‹é—´è¿”å›falseã€‚å¦‚æœè¿˜æ²¡æœ‰è¶…æ—¶å³3.2æ­¥ä¸­çš„ifåˆ¤æ–­ä¸ºtrueæ—¶å°±ä¼šç»§ç»­æ‰§è¡Œ3.3æ­¥é€šè¿‡"),n("strong",[e._v("LockSupport.parkNanos")]),e._v("ä½¿å¾—å½“å‰çº¿ç¨‹é˜»å¡ï¼ŒåŒæ—¶åœ¨3.4æ­¥å¢åŠ äº†å¯¹ä¸­æ–­çš„æ£€æµ‹ï¼Œè‹¥æ£€æµ‹å‡ºè¢«ä¸­æ–­ç›´æ¥æŠ›å‡ºè¢«ä¸­æ–­å¼‚å¸¸ã€‚")]),e._v(" "),n("h2",{attrs:{id:"_4-å…±äº«é”"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-å…±äº«é”"}},[e._v("#")]),e._v(" 4. å…±äº«é”")]),e._v(" "),n("h3",{attrs:{id:"_4-1-å…±äº«é”çš„è·å–-acquireshared-æ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-å…±äº«é”çš„è·å–-acquireshared-æ–¹æ³•"}},[e._v("#")]),e._v(" 4.1 å…±äº«é”çš„è·å–ï¼ˆacquireShared()æ–¹æ³•ï¼‰")]),e._v(" "),n("p",[e._v("åœ¨èŠå®ŒAQSå¯¹ç‹¬å é”çš„å®ç°åï¼Œæˆ‘ä»¬ç»§ç»­ä¸€é¼“ä½œæ°”çš„æ¥çœ‹çœ‹å…±äº«é”æ˜¯æ€æ ·å®ç°çš„ï¼Ÿå…±äº«é”çš„è·å–æ–¹æ³•ä¸ºacquireSharedï¼Œæºç ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public final void acquireShared(int arg) {\n    if (tryAcquireShared(arg) < 0)\n        doAcquireShared(arg);\n}\n")])])]),n("p",[e._v("è¿™æ®µæºç çš„é€»è¾‘å¾ˆå®¹æ˜“ç†è§£ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä¼šé¦–å…ˆè°ƒç”¨tryAcquireSharedæ–¹æ³•ï¼ŒtryAcquireSharedè¿”å›å€¼æ˜¯ä¸€ä¸ªintç±»å‹ï¼Œå½“è¿”å›å€¼ä¸ºå¤§äºç­‰äº0çš„æ—¶å€™æ–¹æ³•ç»“æŸè¯´æ˜è·å¾—æˆåŠŸè·å–é”ï¼Œå¦åˆ™ï¼Œè¡¨æ˜è·å–åŒæ­¥çŠ¶æ€å¤±è´¥å³æ‰€å¼•ç”¨çš„çº¿ç¨‹è·å–é”å¤±è´¥ï¼Œä¼šæ‰§è¡ŒdoAcquireSharedæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„æºç ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private void doAcquireShared(int arg) {\n    final Node node = addWaiter(Node.SHARED);\n    boolean failed = true;\n    try {\n        boolean interrupted = false;\n        for (;;) {\n            final Node p = node.predecessor();\n            if (p == head) {\n                int r = tryAcquireShared(arg);\n                if (r >= 0) {\n\t\t\t\t\t// å½“è¯¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ä¸”æˆåŠŸè·å–åŒæ­¥çŠ¶æ€\n                    setHeadAndPropagate(node, r);\n                    p.next = null; // help GC\n                    if (interrupted)\n                        selfInterrupt();\n                    failed = false;\n                    return;\n                }\n            }\n            if (shouldParkAfterFailedAcquire(p, node) &&\n                parkAndCheckInterrupt())\n                interrupted = true;\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n")])])]),n("p",[e._v("ç°åœ¨æ¥çœ‹è¿™æ®µä»£ç ä¼šä¸ä¼šå¾ˆå®¹æ˜“äº†ï¼Ÿé€»è¾‘å‡ ä¹å’Œç‹¬å å¼é”çš„è·å–ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œçš„è‡ªæ—‹è¿‡ç¨‹ä¸­èƒ½å¤Ÿé€€å‡ºçš„æ¡ä»¶"),n("strong",[e._v("æ˜¯å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹å¹¶ä¸”tryAcquireShared(arg)è¿”å›å€¼å¤§äºç­‰äº0å³èƒ½æˆåŠŸè·å¾—åŒæ­¥çŠ¶æ€")]),e._v("ã€‚")]),e._v(" "),n("h3",{attrs:{id:"_4-2-å…±äº«é”çš„é‡Šæ”¾-releaseshared-æ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-å…±äº«é”çš„é‡Šæ”¾-releaseshared-æ–¹æ³•"}},[e._v("#")]),e._v(" 4.2 å…±äº«é”çš„é‡Šæ”¾ï¼ˆreleaseShared()æ–¹æ³•ï¼‰")]),e._v(" "),n("p",[e._v("å…±äº«é”çš„é‡Šæ”¾åœ¨AQSä¸­ä¼šè°ƒç”¨æ–¹æ³•releaseSharedï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("public final boolean releaseShared(int arg) {\n    if (tryReleaseShared(arg)) {\n        doReleaseShared();\n        return true;\n    }\n    return false;\n}\n")])])]),n("p",[e._v("å½“æˆåŠŸé‡Šæ”¾åŒæ­¥çŠ¶æ€ä¹‹åå³tryReleaseSharedä¼šç»§ç»­æ‰§è¡ŒdoReleaseSharedæ–¹æ³•ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("private void doReleaseShared() {\n    /*\n     * Ensure that a release propagates, even if there are other\n     * in-progress acquires/releases.  This proceeds in the usual\n     * way of trying to unparkSuccessor of head if it needs\n     * signal. But if it does not, status is set to PROPAGATE to\n     * ensure that upon release, propagation continues.\n     * Additionally, we must loop in case a new node is added\n     * while we are doing this. Also, unlike other uses of\n     * unparkSuccessor, we need to know if CAS to reset status\n     * fails, if so rechecking.\n     */\n    for (;;) {\n        Node h = head;\n        if (h != null && h != tail) {\n            int ws = h.waitStatus;\n            if (ws == Node.SIGNAL) {\n                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))\n                    continue;            // loop to recheck cases\n                unparkSuccessor(h);\n            }\n            else if (ws == 0 &&\n                     !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))\n                continue;                // loop on failed CAS\n        }\n        if (h == head)                   // loop if head changed\n            break;\n    }\n}\n")])])]),n("p",[e._v("è¿™æ®µæ–¹æ³•è·Ÿç‹¬å å¼é”é‡Šæ”¾è¿‡ç¨‹æœ‰ç‚¹ç‚¹ä¸åŒï¼Œåœ¨å…±äº«å¼é”çš„é‡Šæ”¾è¿‡ç¨‹ä¸­ï¼Œå¯¹äºèƒ½å¤Ÿæ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®çš„å¹¶å‘ç»„ä»¶ï¼Œå¿…é¡»ä¿è¯å¤šä¸ªçº¿ç¨‹èƒ½å¤Ÿå®‰å…¨çš„é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œè¿™é‡Œé‡‡ç”¨çš„CASä¿è¯ï¼Œå½“CASæ“ä½œå¤±è´¥continueï¼Œåœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­è¿›è¡Œé‡è¯•ã€‚")]),e._v(" "),n("h3",{attrs:{id:"_4-3-å¯ä¸­æ–­-acquiresharedinterruptibly-æ–¹æ³•-è¶…æ—¶ç­‰å¾…-tryacquiresharednanos-æ–¹æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-å¯ä¸­æ–­-acquiresharedinterruptibly-æ–¹æ³•-è¶…æ—¶ç­‰å¾…-tryacquiresharednanos-æ–¹æ³•"}},[e._v("#")]),e._v(" 4.3 å¯ä¸­æ–­ï¼ˆacquireSharedInterruptibly()æ–¹æ³•ï¼‰ï¼Œè¶…æ—¶ç­‰å¾…ï¼ˆtryAcquireSharedNanos()æ–¹æ³•ï¼‰")]),e._v(" "),n("p",[e._v("å…³äºå¯ä¸­æ–­é”ä»¥åŠè¶…æ—¶ç­‰å¾…çš„ç‰¹æ€§å…¶å®ç°å’Œç‹¬å å¼é”å¯ä¸­æ–­è·å–é”ä»¥åŠè¶…æ—¶ç­‰å¾…çš„å®ç°å‡ ä¹ä¸€è‡´ï¼Œå…·ä½“çš„å°±ä¸å†è¯´äº†ï¼Œå¦‚æœç†è§£äº†ä¸Šé¢çš„å†…å®¹å¯¹è¿™éƒ¨åˆ†çš„ç†è§£ä¹Ÿæ˜¯æ°´åˆ°æ¸ æˆçš„ã€‚")]),e._v(" "),n("p",[e._v("é€šè¿‡è¿™ç¯‡ï¼ŒåŠ æ·±äº†å¯¹AQSçš„åº•å±‚å®ç°æ›´åŠ æ¸…æ¥šäº†ï¼Œä¹Ÿå¯¹äº†è§£å¹¶å‘ç»„ä»¶çš„å®ç°åŸç†æ‰“ä¸‹äº†åŸºç¡€ï¼Œå­¦æ— æ­¢å¢ƒï¼Œç»§ç»­åŠ æ²¹:);å¦‚æœè§‰å¾—ä¸é”™ï¼Œè¯·ç»™èµï¼Œå˜¿å˜¿ã€‚")]),e._v(" "),n("p",[e._v("æ¥æºäº https://juejin.cn/post/6844903601538596877")])])}),[],!1,null,null,null);t.default=r.exports}}]);