(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{505:function(e,s,t){"use strict";t.r(s);var a=t(30),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"windows安装-openssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows安装-openssh"}},[e._v("#")]),e._v(" windows安装 OpenSSH")]),e._v(" "),t("blockquote",[t("p",[e._v("适用于 Windows Server 2019、Windows 10、Windows Server 2022")])]),e._v(" "),t("p",[e._v("OpenSSH 是一款用于远程登录的连接工具，它使用 SSH 协议。 它会加密客户端与服务器之间的所有流量，从而遏止窃听、连接劫持和其他攻击。")]),e._v(" "),t("p",[e._v("OpenSSH 可用于将安装了 OpenSSH 客户端的 Window 10（版本 1809 及更高版本）或 Windows Server 2019 设备连接到那些安装了 OpenSSH 服务器的设备。")]),e._v(" "),t("h2",{attrs:{id:"使用-windows-设置来安装-openssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-windows-设置来安装-openssh"}},[e._v("#")]),e._v(" 使用 Windows 设置来安装 OpenSSH")]),e._v(" "),t("p",[e._v("可以使用 Windows Server 2019 和 Windows 10 设备上的 Windows 设置安装这两个 OpenSSH 组件。")]),e._v(" "),t("p",[e._v("若要安装 OpenSSH 组件：")]),e._v(" "),t("ol",[t("li",[e._v("打开“设置”，选择“应用”>“应用和功能”，然后选择“可选功能” 。")]),e._v(" "),t("li",[e._v("扫描列表，查看是否已安装 OpenSSH。 如果未安装，请在页面顶部选择“添加功能”，然后：\n"),t("ul",[t("li",[e._v("查找“OpenSSH 客户端”，再单击“安装”")]),e._v(" "),t("li",[e._v("查找“OpenSSH 服务器”，再单击“安装”")])])])]),e._v(" "),t("p",[e._v("设置完成后，回到“应用”>“应用和功能”和“可选功能”，你应会看到已列出 OpenSSH 。")]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("备注")]),e._v(" "),t("p",[e._v("安装 OpenSSH 服务器将创建并启用一个名为 "),t("code",[e._v("OpenSSH-Server-In-TCP")]),e._v(" 的防火墙规则。 这允许端口 22 上的入站 SSH 流量。 如果未启用此规则且未打开此端口，那么连接将被拒绝或重置。")])]),e._v(" "),t("h2",{attrs:{id:"使用-powershell-安装-openssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-powershell-安装-openssh"}},[e._v("#")]),e._v(" 使用 PowerShell 安装 OpenSSH")]),e._v(" "),t("p",[e._v("若要使用 PowerShell 安装 OpenSSH，请先以管理员身份运行 PowerShell。 为了确保 OpenSSH 可用，请运行以下 cmdlet：")]),e._v(" "),t("p",[e._v("PowerShell")]),e._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Get-WindowsCapability")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Online "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),e._v(" ? Name "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-like")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'OpenSSH*'")]),e._v("\n")])])]),t("p",[e._v("如果两者均尚未安装，则此操作应返回以下输出：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Name  : OpenSSH.Client~~~~0.0.1.0\nState : NotPresent\n\nName  : OpenSSH.Server~~~~0.0.1.0\nState : NotPresent\n")])])]),t("p",[e._v("然后，根据需要安装服务器或客户端组件：")]),e._v(" "),t("p",[e._v("PowerShell")]),e._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Install the OpenSSH Client")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Add-WindowsCapability")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Online "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Name OpenSSH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Client~~~~0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Install the OpenSSH Server")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Add-WindowsCapability")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Online "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Name OpenSSH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Server~~~~0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0\n")])])]),t("p",[e._v("这两者应该都会返回以下输出：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Path          :\nOnline        : True\nRestartNeeded : False\n")])])]),t("h2",{attrs:{id:"启动并配置-openssh-服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动并配置-openssh-服务器"}},[e._v("#")]),e._v(" 启动并配置 OpenSSH 服务器")]),e._v(" "),t("p",[e._v("若要启动并配置 OpenSSH 服务器来开启使用，请以管理员身份打开 PowerShell，然后运行以下命令来启动 "),t("code",[e._v("sshd service")]),e._v("：")]),e._v(" "),t("p",[e._v("PowerShell")]),e._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Start the sshd service")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Start-Service")]),e._v(" sshd\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# OPTIONAL but recommended:")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Set-Service")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Name sshd "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("StartupType "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Automatic'")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Confirm the firewall rule is configured. It should be created automatically by setup.")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Get-NetFirewallRule")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Name "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("ssh"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# There should be a firewall rule named "OpenSSH-Server-In-TCP", which should be enabled')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# If the firewall does not exist, create one")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("New-NetFirewallRule")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Name sshd "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("DisplayName "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'OpenSSH Server (sshd)'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Enabled True "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Direction Inbound "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Protocol TCP "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Action Allow "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("LocalPort 22\n")])])]),t("h2",{attrs:{id:"连接到-openssh-服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接到-openssh-服务器"}},[e._v("#")]),e._v(" 连接到 OpenSSH 服务器")]),e._v(" "),t("p",[e._v("安装后，可从使用 PowerShell 安装了 OpenSSH 客户端的 Windows 10 或 Windows Server 2019 设备连接到 OpenSSH 服务器，如下所示。 请务必以管理员身份运行 PowerShell：")]),e._v(" "),t("p",[e._v("PowerShell")]),e._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[e._v("ssh username@servername\n")])])]),t("p",[e._v("连接后，会收到如下所示的消息：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("The authenticity of host 'servername (10.00.00.001)' can't be established.\nECDSA key fingerprint is SHA256:(<a large string>).\nAre you sure you want to continue connecting (yes/no)?\n")])])]),t("p",[e._v("选择“是”后，该服务器会添加到包含 Windows 客户端上的已知 SSH 主机的列表中。")]),e._v(" "),t("p",[e._v("系统此时会提示你输入密码。 作为安全预防措施，密码在键入的过程中不会显示。")]),e._v(" "),t("p",[e._v("连接后，你将看到 Windows 命令行界面提示符：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("domain\\username@SERVERNAME C:\\Users\\username>\n")])])]),t("h2",{attrs:{id:"使用-windows-设置来卸载-openssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-windows-设置来卸载-openssh"}},[e._v("#")]),e._v(" 使用 Windows 设置来卸载 OpenSSH")]),e._v(" "),t("p",[e._v("若要使用 Windows 设置来卸载 OpenSSH：")]),e._v(" "),t("ol",[t("li",[e._v("打开“设置”，然后转到“应用”>“应用和功能” 。")]),e._v(" "),t("li",[e._v("转到“可选功能”。")]),e._v(" "),t("li",[e._v("在列表中，选择“OpenSSH 客户端”或“OpenSSH 服务器” 。")]),e._v(" "),t("li",[e._v("选择“卸载”。")])]),e._v(" "),t("h2",{attrs:{id:"使用-powershell-卸载-openssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-powershell-卸载-openssh"}},[e._v("#")]),e._v(" 使用 PowerShell 卸载 OpenSSH")]),e._v(" "),t("p",[e._v("若要使用 PowerShell 卸载 OpenSSH 组件，请使用以下命令：")]),e._v(" "),t("p",[e._v("PowerShell")]),e._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Uninstall the OpenSSH Client")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Remove-WindowsCapability")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Online "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Name OpenSSH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Client~~~~0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Uninstall the OpenSSH Server")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Remove-WindowsCapability")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Online "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Name OpenSSH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Server~~~~0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("0\n")])])]),t("p",[e._v("如果在卸载时服务正在使用中，稍后可能需要重启 Windows。")]),e._v(" "),t("h2",{attrs:{id:"离线安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#离线安装"}},[e._v("#")]),e._v(" 离线安装")]),e._v(" "),t("h3",{attrs:{id:"下载安装包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载安装包"}},[e._v("#")]),e._v(" 下载安装包")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/PowerShell/Win32-OpenSSH/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("openssh的二进制可执行版本"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"解压"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解压"}},[e._v("#")]),e._v(" 解压")]),e._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("powershell.exe -ExecutionPolicy Bypass -File install-sshd.ps1\n")])])]),t("p",[e._v("安装成功提示：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[SC] SetServiceObjectSecurity SUCCESS\n[SC] ChangeServiceConfig2 SUCCESS\n[SC] ChangeServiceConfig2 SUCCESS\nsshd and ssh-agent services successfully installed\n")])])]),t("p",[e._v("如果端口没有打开， 需要执行如下命令打开SSH 需要的22端口。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("netsh advfirewall firewall add rule name=sshd dir=in action=allow protocol=TCP localport=22\n")])])]),t("h3",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[e._v("#")]),e._v(" 启动")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("net start sshd\nnet start ssh-agent\n")])])]),t("h3",{attrs:{id:"环境变量配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境变量配置"}},[e._v("#")]),e._v(" 环境变量配置")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/image-20210823114103403.png",alt:"image-20210823114103403"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);