(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{467:function(a,t,s){"use strict";s.r(t);var e=s(30),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"分布式配置中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分布式配置中心"}},[a._v("#")]),a._v(" 分布式配置中心")]),a._v(" "),s("p",[a._v("在我们前面介绍Nacos的时候，说到，Nacos除了可以作为注册中心，还可以作为配置中心，而在SpringCloud Netfilx的体系下，这个工作是由Spring Cloud Config完成的。")]),a._v(" "),s("p",[a._v("至于为什么需要配置中心？大家想一下，在微服务开发体系下，整个系统可能被拆分成几十、上百个服务，在生产的时候，每个服务可能部署几十上百个节点，而且通常是又多个环境，如开发、测试、预发布、成产等等，如果没有一个集中式的配置中心，一个个去管理，那是一个多么😥的事情。")]),a._v(" "),s("p",[a._v("好了，接下来我们开始愉快地学习Nacos作为分布式配置中心吧！")]),a._v(" "),s("h2",{attrs:{id:"nacos配置基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置基本概念"}},[a._v("#")]),a._v(" Nacos配置基本概念")]),a._v(" "),s("p",[a._v("在正式开始实战之前，我们先了解一下Nacos配置的一些基本概念。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/9caaf5891cde4f468f16e9a96b112180~tplv-k3u1fbpfcp-watermark.png",alt:"Nacos配置中心概念"}})]),a._v(" "),s("p",[a._v("上图我们可以看到Nacos作为配置中心的几个主要概念：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("命名空间")])])]),a._v(" "),s("blockquote",[s("p",[a._v("区分环境，比如：dev、test、prod 等等。")])]),a._v(" "),s("p",[a._v("用于进行租户粒度的配置隔离。不同的命名空间下，可以存在相同的 Group 或 Data ID 的配置。Namespace 的常用场景之一是不同环境的配置的区分隔离，例如开发测试环境和生产环境的资源（如配置、服务）隔离等。")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("配置分组")])])]),a._v(" "),s("blockquote",[s("p",[a._v("多个配置文件放在一起，形成组，一般用于区分项目。例如，某学校多应用之间的区分，教师应用 TEACHER_GROUP，学生应用 STUDENT_GROUP。")])]),a._v(" "),s("p",[a._v("Nacos 中的一组配置集，是组织配置的维度之一。通过一个有意义的字符串（如 Buy 或 Trade ）对配置集进行分组，从而区分 Data  ID 相同的配置集。当您在 Nacos 上创建一个配置时，如果未填写配置分组的名称，则配置分组的名称默认采用 DEFAULT_GROUP  。配置分组的常见场景：不同的应用或组件使用了相同的配置类型，如 database_url 配置和 MQ_topic 配置。")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("配置集")])])]),a._v(" "),s("blockquote",[s("p",[a._v("多个键值对，一般指一个配置文件。")])]),a._v(" "),s("p",[a._v("一组相关或者不相关的配置项的集合称为配置集（多个键值对/一个配置文件）。在系统中，一个配置文件通常就是一个配置集，包含了系统各个方面的配置。例如，一个配置集可能包含了数据源、线程池、日志级别等配置项。")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("配置集ID")])])]),a._v(" "),s("blockquote",[s("p",[a._v("给这个配置文件起一个全局唯一的 ID。")])]),a._v(" "),s("p",[a._v("Nacos 中的某个配置集的 ID。配置集 ID 是组织划分配置的维度之一。Data ID  通常用于组织划分系统的配置集。一个系统或者应用可以包含多个配置集，每个配置集都可以被一个有意义的名称标识。Data ID 通常采用类 Java  包（如 com.taobao.tc.refund.log.level）的命名规则保证全局唯一性。此命名规则非强制。")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("配置项")])])]),a._v(" "),s("blockquote",[s("p",[a._v("一个键值对 <Key = Value>")])]),a._v(" "),s("p",[a._v("一个具体的可配置的参数与其值域（一个键值对），通常以 param-key=param-value 的形式存在。例如我们常配置系统的日志输出级别（logLevel=INFO|WARN|ERROR） 就是一个配置项。")]),a._v(" "),s("p",[a._v("给大家看一个Nacos的配置示例，这些概念相信你就都明白。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/549b5b29e72b44b596796da9dc69453a~tplv-k3u1fbpfcp-watermark.png",alt:"Nacos配置示例"}})]),a._v(" "),s("h2",{attrs:{id:"引入nacos配置中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引入nacos配置中心"}},[a._v("#")]),a._v(" 引入Nacos配置中心")]),a._v(" "),s("p",[a._v("我们以eshop-user为例演示我们的配置中心。")]),a._v(" "),s("h3",{attrs:{id:"引入nacos-config依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引入nacos-config依赖"}},[a._v("#")]),a._v(" 引入nacos-config依赖")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" spring cloud alibaba nacos config 依赖 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("alibaba"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("groupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("starter"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("alibaba"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("config"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dependency"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n")])])]),s("h3",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[a._v("#")]),a._v(" 配置文件")]),a._v(" "),s("p",[a._v("和SpringCloud Conig类似，我们必需要在 "),s("code",[a._v("bootstrap.yml")]),a._v("配置文件中进行配置，在"),s("code",[a._v("application.yml")]),a._v("中无效，"),s("code",[a._v("bootstrap.yml")]),a._v("优先级高于"),s("code",[a._v("application.yml")]),a._v("。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  application"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("service # 应用名称\n  profiles"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    active"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" dev      # 当前环境对应的 profile\n  cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n      config"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n        enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("     # 如果不想使用 "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Nacos")]),a._v(" 进行配置管理，设置为 "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v(" 即可\n        server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("   # "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Nacos")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Server")]),a._v(" 地址\n        group"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" DEFAULT_GROUP     # 组，默认为 DEFAULT_GROUP\n        file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("extension"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" yaml    # 配置内容的数据格式，默认为 properties\n\n")])])]),s("blockquote",[s("p",[a._v("说明：之所以需要配置 "),s("code",[a._v("spring.application.name")]),a._v("，是因为它是构成 Nacos 配置管理 "),s("code",[a._v("dataId")]),a._v("字段的一部分。")])]),a._v(" "),s("p",[a._v("在 Nacos Spring Cloud 中，"),s("code",[a._v("dataId")]),a._v(" 的完整格式如下：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("${prefix}-${spring.profile.active}.${file-extension}\n")])])]),s("ul",[s("li",[s("code",[a._v("prefix")]),a._v(" 默认为 "),s("code",[a._v("spring.application.name")]),a._v(" 的值，也可以通过配置项 "),s("code",[a._v("spring.cloud.nacos.config.prefix")]),a._v("来配置。")]),a._v(" "),s("li",[s("code",[a._v("spring.profile.active")]),a._v(" 即为当前环境对应的 profile。"),s("strong",[a._v("注意：当 "),s("code",[a._v("spring.profile.active")]),a._v(" 为空时，对应的连接符 "),s("code",[a._v("-")]),a._v(" 也将不存在，dataId 的拼接格式将变成 "),s("code",[a._v("${prefix}.${file-extension}")])])]),a._v(" "),s("li",[s("code",[a._v("file-exetension")]),a._v(" 为配置内容的数据格式，可以通过配置项 "),s("code",[a._v("spring.cloud.nacos.config.file-extension")]),a._v(" 来配置。目前只支持 "),s("code",[a._v("properties")]),a._v(" 和 "),s("code",[a._v("yaml")]),a._v(" 类型，默认为 "),s("code",[a._v("properties")]),a._v("。")])]),a._v(" "),s("h3",{attrs:{id:"nacos-server创建配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos-server创建配置"}},[a._v("#")]),a._v(" Nacos Server创建配置")]),a._v(" "),s("p",[a._v("我们在Nacos Server的配置列表中新建一个配置。")]),a._v(" "),s("p",[s("code",[a._v("Data Id")]),a._v(" 为 "),s("code",[a._v("user-service.yaml")]),a._v("，组使用默认组，并添加 "),s("code",[a._v("yaml")]),a._v(" 格式的配置信息。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/d77edb0147e547f0b559dbf0446db823~tplv-k3u1fbpfcp-watermark.png",alt:"Nacoos新建配置"}})]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("project"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" e"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("shop"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("userservice\n  author"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" fighter3\n\n")])])]),s("h3",{attrs:{id:"控制层"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#控制层"}},[a._v("#")]),a._v(" 控制层")]),a._v(" "),s("p",[a._v("使用 Spring 的 "),s("code",[a._v("@Value")]),a._v(" 注解来获取配置信息，"),s("code",[a._v("${}")]),a._v(" 中对应 Nacos 配置中心配置内容的 key，"),s("code",[a._v(":")]),a._v("后跟默认值。")]),a._v(" "),s("p",[a._v("并且通过 Spring Cloud 原生注解 "),s("code",[a._v("@RefreshScope")]),a._v(" 实现配置自动更新。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * @Author: 三分恶\n * @Date: 2021/5/30\n * @Description: Nacos配置项获取\n **/")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RefreshScope")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RestController")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/shop-user"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Api")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"配置信息接口"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" tags "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"配置信息接口"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NacosConfigController")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${project.name:}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" projectName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${project.author:}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" projectAuthor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/config"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@ApiOperation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"获取Nacos配置项"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" configMap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        configMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"projectName"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" projectName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        configMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"projectAuthor"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" projectAuthor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" configMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("启动"),s("code",[a._v("user-service")]),a._v("服务。")]),a._v(" "),s("p",[a._v("访问knife4j接口地址："),s("a",{attrs:{href:"https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fdoc.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:8080/doc.html"),s("OutboundLink")],1),a._v("  ，调用获取Nacos配置项接口：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/129e8f21d5be4514ac8e24978df71eec~tplv-k3u1fbpfcp-watermark.png",alt:"获取配置项"}})]),a._v(" "),s("p",[a._v("接下来，我们修改一下配置项，并发布：")]),a._v(" "),s("p",[a._v("可以看到控制台打印输出：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7723bc43316d4cb9827b2bcda383816b~tplv-k3u1fbpfcp-watermark.awebp",alt:"控制台打印输出"}})]),a._v(" "),s("p",[a._v("再次访问获取配置接口：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/288822f6feba4e3cb75fc2b4f8cef823~tplv-k3u1fbpfcp-watermark.png",alt:"获取修改后的配置项"}})]),a._v(" "),s("p",[a._v("OK，到这我们已经成功地读取了Nacos配置中心的配置，接下来，我们尝试将服务的配置，例如数据源来进行统一的集中配置。")]),a._v(" "),s("h2",{attrs:{id:"集中配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集中配置"}},[a._v("#")]),a._v(" 集中配置")]),a._v(" "),s("p",[a._v("好，我们开始进行Nacos集中配置的实战：")]),a._v(" "),s("h3",{attrs:{id:"新建命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建命名空间"}},[a._v("#")]),a._v(" 新建命名空间")]),a._v(" "),s("p",[a._v("我们之前用的是默认的命名空间，接下来我们创建一个新的命名空间，用于我们开发环境的配置。我们给它命名为"),s("code",[a._v("dev_space")]),a._v(":")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/e5181a8669c64f5bab095b729f2a939b~tplv-k3u1fbpfcp-watermark.png",alt:"新建命名空间"}})]),a._v(" "),s("p",[a._v("这里使用了命名空间来隔离配置，如果我们想要一个测试环境的配置，如法炮制，建一个新的空间就行了。")]),a._v(" "),s("h3",{attrs:{id:"创建数据源配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建数据源配置"}},[a._v("#")]),a._v(" 创建数据源配置")]),a._v(" "),s("p",[a._v("接下来我们在"),s("code",[a._v("dev_space")]),a._v("下创建一个新的配置"),s("code",[a._v("user-service-dev.yaml")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/3dcefeba722a431485654feff6534256~tplv-k3u1fbpfcp-watermark.png",alt:"新建配置"}})]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("project"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" e"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("shop"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("userservice\n  author"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" fighter3\n# 数据源配置\nspring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  datasource"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    driver"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),a._v("Driver")]),a._v("\n    url"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" jdbc"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("localhost"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("shop_user"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),a._v("characterEncoding"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("utf"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("allowMultiQueries"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("serverTimezone"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("GMT"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("B8\n    username"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" root\n    password"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" root \n\n")])])]),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/3d498c4d23af4dae8f8bad426638db77~tplv-k3u1fbpfcp-watermark.png",alt:"dev-space"}})]),a._v(" "),s("h3",{attrs:{id:"修改本地配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改本地配置"}},[a._v("#")]),a._v(" 修改本地配置")]),a._v(" "),s("p",[a._v("我们在bootstrap.yml中指定命名空间，完整bootstrap.yml如下：")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  application"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("service # 应用名称\n  profiles"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    active"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" dev      # 当前环境对应的 profile\n  cloud"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n      config"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n        enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("     # 如果不想使用 "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Nacos")]),a._v(" 进行配置管理，设置为 "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v(" 即可\n        server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("   # "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Nacos")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Server")]),a._v(" 地址\n        group"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" DEFAULT_GROUP     # 组，默认为 DEFAULT_GROUP\n        file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("extension"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" yaml    # 配置内容的数据格式，默认为 properties\n        namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" dev_space    # 指定命名空间，默认为"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v("\n\n")])])]),s("p",[a._v("修改application.yml，注释掉数据源相关配置：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dffabdf4b1f9476185543362f3ad58af~tplv-k3u1fbpfcp-watermark.awebp",alt:"数据源配置注释"}})]),a._v(" "),s("h3",{attrs:{id:"测试-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("启动用户服务，服务正常启动以后，我们分别调试获取用户信息接口和获取配置接口。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/wuyilong/picture-bed/raw/master/img/e7894aded8da4af284096a437b94be67~tplv-k3u1fbpfcp-watermark.png",alt:"获取用户"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9da5470e4f1f46b7817bb20b92c1ad7e~tplv-k3u1fbpfcp-watermark.awebp",alt:"配置项"}})]),a._v(" "),s("p",[a._v("OK，获取到了预期的结果。")]),a._v(" "),s("p",[a._v("好了，Nacos作为分布式配置中心的实战到此结束了，了解更多可以直接查看官方文档！")]),a._v(" "),s("p",[a._v("作者：三分恶\n链接：https://juejin.cn/post/6979915003881226270\n来源：掘金\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。")])])}),[],!1,null,null,null);t.default=r.exports}}]);